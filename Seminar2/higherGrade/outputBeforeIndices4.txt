                                                                                                    QUERY PLAN                                                                                                                                                                                                                                                                                                 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=14.53..14.53 rows=1 width=116) (actual time=0.341..0.351 rows=3 loops=1)
   Sort Key: ((((a.total_allocated_hours - (((sum(((planned_activity.planned_hours)::numeric * teaching_activity.factor)) + ((('2'::numeric * course_layout.hp) + '28'::numeric) + (0.2 * (course_instance.num_students)::numeric))) + ('32'::numeric + (0.725 * (course_instance.num_students)::numeric))))) / (((sum(((planned_activity.planned_hours)::numeric * teaching_activity.factor)) + ((('2'::numeric * course_layout.hp) + '28'::numeric) + (0.2 * (course_instance.num_students)::numeric))) + ('32'::numeric + (0.725 * (course_instance.num_students)::numeric))))) * '100'::numeric)) DESC
   Sort Method: quicksort  Memory: 25kB
   ->  Hash Join  (cost=14.16..14.52 rows=1 width=116) (actual time=0.330..0.344 rows=3 loops=1)
         Hash Cond: ((course_instance.instance_id)::text = (a.instance_id)::text)
         Join Filter: (abs(((a.total_allocated_hours - (((sum(((planned_activity.planned_hours)::numeric * teaching_activity.factor)) + ((('2'::numeric * course_layout.hp) + '28'::numeric) + (0.2 * (course_instance.num_students)::numeric))) + ('32'::numeric + (0.725 * (course_instance.num_students)::numeric))))) / (((sum(((planned_activity.planned_hours)::numeric * teaching_activity.factor)) + ((('2'::numeric * course_layout.hp) + '28'::numeric) + (0.2 * (course_instance.num_students)::numeric))) + ('32'::numeric + (0.725 * (course_instance.num_students)::numeric)))))) > 0.15)
         ->  HashAggregate  (cost=4.65..4.87 rows=6 width=165) (actual time=0.098..0.109 rows=5 loops=1)
               Group Key: course_layout.course_code, course_layout.hp, course_instance.instance_id, course_instance.study_period, course_instance.num_students
               Batches: 1  Memory Usage: 24kB
               ->  Hash Join  (cost=3.35..4.53 rows=6 width=48) (actual time=0.070..0.080 rows=7 loops=1)
                     Hash Cond: (planned_activity.teaching_activity_id = teaching_activity.id)
                     ->  Hash Join  (cost=2.26..3.40 rows=6 width=45) (actual time=0.032..0.040 rows=7 loops=1)
                           Hash Cond: (course_instance.course_layout_id = course_layout.id)
                           ->  Hash Join  (cost=1.15..2.26 rows=6 width=37) (actual time=0.019..0.024 rows=7 loops=1)
                                 Hash Cond: (planned_activity.course_instance_id = course_instance.id)
                                 ->  Seq Scan on planned_activity  (cost=0.00..1.08 rows=8 width=12) (actual time=0.004..0.005 rows=8 loops=1)
                                 ->  Hash  (cost=1.09..1.09 rows=5 width=33) (actual time=0.009..0.009 rows=5 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                       ->  Seq Scan on course_instance  (cost=0.00..1.09 rows=5 width=33) (actual time=0.006..0.007 rows=5 loops=1)
                                             Filter: (study_year = '2025-01-01'::date)
                                             Rows Removed by Filter: 2
                           ->  Hash  (cost=1.05..1.05 rows=5 width=16) (actual time=0.010..0.010 rows=5 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                 ->  Seq Scan on course_layout  (cost=0.00..1.05 rows=5 width=16) (actual time=0.007..0.008 rows=5 loops=1)
                     ->  Hash  (cost=1.04..1.04 rows=4 width=11) (actual time=0.034..0.034 rows=4 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 9kB
                           ->  Seq Scan on teaching_activity  (cost=0.00..1.04 rows=4 width=11) (actual time=0.019..0.020 rows=4 loops=1)
         ->  Hash  (cost=9.49..9.49 rows=2 width=46) (actual time=0.218..0.224 rows=4 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 9kB
               ->  Subquery Scan on a  (cost=9.27..9.49 rows=2 width=46) (actual time=0.199..0.209 rows=4 loops=1)
                     ->  GroupAggregate  (cost=9.27..9.47 rows=2 width=52) (actual time=0.198..0.208 rows=4 loops=1)
                           Group Key: allocated_hours_view.course_code, allocated_hours_view.instance_id
                           ->  Incremental Sort  (cost=9.27..9.43 rows=2 width=52) (actual time=0.194..0.199 rows=10 loops=1)
                                 Sort Key: allocated_hours_view.course_code, allocated_hours_view.instance_id
                                 Presorted Key: allocated_hours_view.course_code
                                 Full-sort Groups: 1  Sort Method: quicksort  Average Memory: 25kB  Peak Memory: 25kB
                                 ->  Subquery Scan on allocated_hours_view  (cost=9.18..9.34 rows=2 width=52) (actual time=0.163..0.190 rows=10 loops=1)
                                       ->  GroupAggregate  (cost=9.18..9.32 rows=2 width=189) (actual time=0.163..0.187 rows=10 loops=1)
                                             Group Key: course_layout_1.course_code, course_layout_1.hp, course_instance_1.instance_id, course_instance_1.study_period, course_instance_1.study_year, course_instance_1.num_students, person.first_name, person.last_name, job_title.job_title
                                             ->  Sort  (cost=9.18..9.18 rows=2 width=72) (actual time=0.143..0.148 rows=11 loops=1)
                                                   Sort Key: course_layout_1.course_code, course_layout_1.hp, course_instance_1.instance_id, course_instance_1.study_period, course_instance_1.study_year, course_instance_1.num_students, person.first_name, person.last_name, job_title.job_title
                                                   Sort Method: quicksort  Memory: 26kB
                                                   ->  Hash Join  (cost=7.91..9.17 rows=2 width=72) (actual time=0.088..0.109 rows=11 loops=1)
                                                         Hash Cond: (allocation.employee_id = employee.id)
                                                         ->  Hash Join  (cost=4.56..5.79 rows=2 width=52) (actual time=0.052..0.068 rows=11 loops=1)
                                                               Hash Cond: (planned_activity_1.teaching_activity_id = teaching_activity_1.id)
                                                               ->  Hash Join  (cost=3.47..4.69 rows=2 width=49) (actual time=0.041..0.054 rows=11 loops=1)
                                                                     Hash Cond: (course_instance_1.course_layout_id = course_layout_1.id)
                                                                     ->  Hash Join  (cost=2.36..3.58 rows=2 width=41) (actual time=0.031..0.040 rows=11 loops=1)
                                                                           Hash Cond: ((course_instance_1.id = planned_activity_1.course_instance_id) AND ((allocation.planned_activity)::text = (planned_activity_1.planned_activity)::text))
                                                                           ->  Hash Join  (cost=1.16..2.32 rows=11 width=57) (actual time=0.019..0.023 rows=11 loops=1)
                                                                                 Hash Cond: (allocation.course_instance_id = course_instance_1.id)
                                                                                 ->  Seq Scan on allocation  (cost=0.00..1.11 rows=11 width=24) (actual time=0.004..0.005 rows=11 loops=1)
                                                                                 ->  Hash  (cost=1.07..1.07 rows=7 width=33) (actual time=0.011..0.011 rows=7 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                                                       ->  Seq Scan on course_instance course_instance_1  (cost=0.00..1.07 rows=7 width=33) (actual time=0.002..0.003 rows=7 loops=1)
                                                                           ->  Hash  (cost=1.08..1.08 rows=8 width=27) (actual time=0.009..0.009 rows=8 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                                                 ->  Seq Scan on planned_activity planned_activity_1  (cost=0.00..1.08 rows=8 width=27) (actual time=0.002..0.003 rows=8 loops=1)
                                                                     ->  Hash  (cost=1.05..1.05 rows=5 width=16) (actual time=0.006..0.007 rows=5 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                                           ->  Seq Scan on course_layout course_layout_1  (cost=0.00..1.05 rows=5 width=16) (actual time=0.002..0.002 rows=5 loops=1)
                                                               ->  Hash  (cost=1.04..1.04 rows=4 width=11) (actual time=0.007..0.008 rows=4 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                                     ->  Seq Scan on teaching_activity teaching_activity_1  (cost=0.00..1.04 rows=4 width=11) (actual time=0.003..0.003 rows=4 loops=1)
                                                         ->  Hash  (cost=3.29..3.29 rows=5 width=28) (actual time=0.032..0.033 rows=5 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                               ->  Hash Join  (cost=2.18..3.29 rows=5 width=28) (actual time=0.023..0.027 rows=5 loops=1)
                                                                     Hash Cond: (employee.job_title_id = job_title.id)
                                                                     ->  Hash Join  (cost=1.11..2.19 rows=5 width=20) (actual time=0.012..0.014 rows=5 loops=1)
                                                                           Hash Cond: (employee.person_id = person.id)
                                                                           ->  Seq Scan on employee  (cost=0.00..1.05 rows=5 width=12) (actual time=0.003..0.003 rows=5 loops=1)
                                                                           ->  Hash  (cost=1.05..1.05 rows=5 width=16) (actual time=0.005..0.006 rows=5 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                                                 ->  Seq Scan on person  (cost=0.00..1.05 rows=5 width=16) (actual time=0.003..0.004 rows=5 loops=1)
                                                                     ->  Hash  (cost=1.03..1.03 rows=3 width=16) (actual time=0.008..0.009 rows=3 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                                           ->  Seq Scan on job_title  (cost=0.00..1.03 rows=3 width=16) (actual time=0.006..0.007 rows=3 loops=1)
 Planning Time: 4.228 ms
 Execution Time: 0.497 ms
(80 rows)
